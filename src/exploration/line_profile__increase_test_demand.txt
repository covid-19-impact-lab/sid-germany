Timer unit: 1e-06 s

Total time: 0.994634 s
File: /home/klara/Dropbox/Projects/sid-germany/src/testing/testing_models.py
Function: _increase_test_demand at line 291

Line #      Hits         Time  Per Hit   % Time  Line Contents
==============================================================
   291                                           def _increase_test_demand(demanded, states, n_undemanded_tests, group):
   292                                               """Randomly increase the number of tests demanded in an age group.
   293                                               This is the case where we have additional positive tests to distribute.
   294                                           
   295                                               """
   296        49      12381.0    252.7      1.2      demanded = demanded.copy(deep=True)
   297                                           
   298        49         65.0      1.3      0.0      right_age_group = f"(age_group_rki == '{group}')"
   299        49         22.0      0.4      0.0      currently_infected = "(infectious | symptomatic | (cd_infectious_true >= 0))"
   300        49         17.0      0.3      0.0      untested = "(~pending_test & ~knows_immune)"
   301        49         45.0      0.9      0.0      selection_string = right_age_group + " & " + currently_infected + " & " + untested
   302                                           
   303        49     898996.0  18346.9     90.4      infected_untested = states.index[states.eval(selection_string) & ~demanded]
   304                                           
   305        49        147.0      3.0      0.0      if len(infected_untested) >= n_undemanded_tests:
   306        49       2971.0     60.6      0.3          drawn = np.random.choice(infected_untested, n_undemanded_tests, replace=False)
   307                                               else:
   308                                                   date = get_date(states)
   309                                                   warnings.warn(
   310                                                       f"\n\nThe implied share_known_cases for age group {group} is >1 "
   311                                                       f"on date {date.date()} ({date.day_name()}).\n\n"
   312                                                   )
   313                                                   drawn = infected_untested
   314        49      79946.0   1631.6      8.0      demanded.loc[drawn] = True
   315        49         44.0      0.9      0.0      return demanded